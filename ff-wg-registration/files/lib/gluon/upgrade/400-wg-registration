#!/bin/sh

rm /etc/config/wireguard
touch /etc/config/wireguard

#Ist multidomainsupport aktiviert?
domain=$(uci get gluon.core.domain)
if [ -z "$domain" ]; then {                     #falls nein
        datei="/lib/gluon/site.json";
} else {                                        #falls ja
        datei="/lib/gluon/domains/$domain.json";
}
fi

uci set wireguard.mesh_vpn=wireguard
uci set wireguard.mesh_vpn.broker=$(jsonfilter -i $datei -e "$.mesh_vpn.wireguard.broker")
uci commit wireguard